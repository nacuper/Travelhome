daemon off;

events {
	worker_connections  4096;  ## Default: 1024
}

http {
	include    mime.types;

	upstream us_travelclub {
		server 200.14.133.16 weight=2;
		server 200.14.130.60;
	}

	upstream us_travelclub-assistcard-test {
		server travelclub-assistcard-test.herokuapp.com;
	}

	upstream us_latercera {
		server latercera.herokuapp.com;
	}

	upstream us_hoteles {
		server 66.234.9.97;
	}

#	server {
#		listen <%= ENV['PORT'] %>;
#		server_name viajes.travel.cl;
#
#		location /Hoteles/Lista {
#			proxy_set_header Host viajes.travel.cl;
#			proxy_pass http://us_hoteles; 
#		}
#	}

	server {
		listen <%= ENV['PORT'] %>;
		server_name viajes-test.travel.cl;
		
		location = / {
			rewrite ^/$ /agency/travelclub break;
			proxy_set_header Host latercera.herokuapp.com;
			proxy_pass http://us_latercera; 
		}

		location = /vuelos {
			rewrite ^/vuelos$ /agency/travelclub break;
			proxy_set_header Host latercera.herokuapp.com;
			proxy_pass http://us_latercera; 
		}

		location = /programas {
			rewrite ^/programas$ /searchHome/travelclub break;
			proxy_set_header Host latercera.herokuapp.com;
			proxy_pass http://us_latercera; 
		}

		location = /asistencia {
			rewrite ^/asistencia$ /assist-card break;
			proxy_set_header Host latercera.herokuapp.com;
			proxy_pass http://us_latercera; 
		}

		location / {
			proxy_set_header Host latercera.herokuapp.com;
			proxy_pass http://us_latercera; 
		}

#		location /Hoteles/Lista {
#			proxy_set_header Host viajes.travel.cl;
#			proxy_pass http://us_hoteles; 
#		}
#		location /Hoteles/Tarifas {
#			proxy_set_header Host viajes.travel.cl;
#			proxy_pass http://us_hoteles;
#		}
#		location /__libFx {
#			proxy_set_header Host viajes.travel.cl;
#			proxy_pass http://us_hoteles; 
#		}
#		location /_lib {
#			proxy_set_header Host viajes.travel.cl;
#			proxy_pass http://us_hoteles; 
#		}
#		location /lib {
#			proxy_set_header Host viajes.travel.cl;
#			proxy_pass http://us_hoteles; 
#		}
#		location /_Ajax {
#			proxy_set_header Host viajes.travel.cl;
#			proxy_pass http://us_hoteles;
#		}
#		location /SparksVista {
#			proxy_set_header Host viajes.travel.cl;
#			proxy_pass http://us_hoteles;
#		}
#		location /Ktravel {
#			proxy_set_header Host viajes.travel.cl;
#			proxy_pass http://us_hoteles;
#		}
#		location /Reservacion {
#			proxy_set_header Host viajes.travel.cl;
#			proxy_pass http://us_hoteles;
#		}
#		location /hoteles {
#			rewrite /hoteles /agency/hoteles  break;
#			proxy_set_header Host travelclub-assistcard-test.herokuapp.com;
#			proxy_pass http://us_travelclub-assistcard-test; 
#		}
	}

	server {
		listen <%= ENV['PORT'] %>;
		server_name tienda.travel.cl;
		
		location /traveltienda {
			rewrite /traveltienda/(.*) /traveltienda/$1  break;
			proxy_set_header Host www.travelclub.cl;
			proxy_pass http://us_travelclub;
		}

		location /upload {
			rewrite /(.*) /$1  break;
			proxy_set_header Host www.travelclub.cl;
			proxy_pass http://us_travelclub;
		}
 
        location = / {
			rewrite ^/$ /traveltienda/  break;
			proxy_set_header Host www.travelclub.cl;
			proxy_pass http://us_travelclub; 
		}

		location / {
			rewrite /(.*) /traveltienda/$1  break;
			proxy_set_header Host www.travelclub.cl;
			proxy_pass http://us_travelclub; 
		}
	}

	server {
		listen <%= ENV['PORT'] %>;
		server_name duty.travel.cl;
		
		location /producto {
			rewrite /(.*) /tienda/$1  break;
			proxy_set_header Host www.travelclub.cl;
			proxy_pass http://us_travelclub;
		}
                         
		location /img {
			rewrite /(.*) /tienda/$1  break;
			proxy_set_header Host www.travelclub.cl;
			proxy_pass http://us_travelclub;
		}
 
        location / {
			rewrite ^/$ /tienda/  break;
			proxy_set_header Host www.travelclub.cl;
			proxy_pass http://us_travelclub; 
		}
	}

	server {
		listen <%= ENV['PORT'] %> default_server;
		listen [::]:<%= ENV['PORT'] %> default_server ipv6only=on;
		server_name travelclub-nginx.herokuapp.com;
		
		location /producto {
			rewrite /(.*) /tienda/$1  break;
			proxy_set_header Host www.travelclub.cl;
			proxy_pass http://us_travelclub; 
		}

		location /* {
			proxy_set_header Host www.travelclub.cl;
			proxy_pass http://us_travelclub; 
		}

		location / {
			rewrite ^/$ /tienda/  break;
			proxy_set_header Host www.travelclub.cl;
			proxy_pass http://us_travelclub; 
		}
	}
}